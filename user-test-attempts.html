<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Test Attempts</title>
    <!-- CSS -->
    <link rel="stylesheet" href="/css/admin.css"> <!-- Your existing CSS -->
     <!-- Boxicon -->
     <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
     

    <style>
       
    </style>
</head>

<body>
    <div class="Teacher-Page">
        <header>
            <nav>
                <div id="head">
                    <i class='bx bx-menu'></i> <!-- Icon for toggling the sidebar -->
                    <img src="https://techpaathshala.com/assets//images/home/techpathshala_mobile_logo.svg">
                    <div id="admin-logout-btn"></div>
                    <p id="welcome-admin">Welcome Anshika</p>
                </div>
            </nav>
        </header>

        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <ul>
                <li class="menu-title">Dashboard</li>
                <li><a href="admin-home-page.html"><i class='bx bx-home'></i>Home</a></li>
                <li><a href="student-information.html"><i class='bx bxs-user-circle'></i>Users</a></li>
                <li><a href="EditeQuestion.html"><i class='bx bx-question-mark'></i>Quizzes</a></li>
                <li id="logout-btn" ><strong><i class='bx bx-log-out' >
                </i> Logout</strong></li>
            </ul>
        </div>

        <h1>User Test Attempts</h1>

        <!-- Div part where the table will be displayed -->
        <div id="test-attempts"></div>

    </div>

    <script>
        // Toggle sidebar visibility when menu icon is clicked
        document.querySelector('.bx-menu').addEventListener('click', function () {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        });

        // Function to get query parameters from the URL
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // Function to display the test attempts for the specific user
        function displayUserTestAttempts() {
            const userEmail = getQueryParam('email'); // Get the email from the URL query parameter

            if (!userEmail) {
                document.getElementById('test-attempts').innerHTML = '<p>.</p>';
                return;
            }

            // Retrieve all test attempts from localStorage
            const testAttempts = JSON.parse(localStorage.getItem('testAttempts')) || [];

            const userAttempts = testAttempts.filter(attempt => attempt.userEmail === userEmail);

            const attemptsContainer = document.getElementById('test-attempts');
            if (userAttempts.length === 0) {
                attemptsContainer.innerHTML = '<p>No test.</p>';
                return;
            }

            let tableHtml = `
                <table>
                    <thead>
                        <tr>
                            <th>Test Attempt</th>
                            <th>Score</th>
                            <th>Timestamp</th>
                            <th>Time Spent (Minute)</th>
                            <th>View Test Details</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            <!-- Part of the displayUserTestAttempts function -->
userAttempts.forEach((attempt, index) => {
    tableHtml += `
        <tr>
            <td>Attempt ${index + 1}</td>
            <td>${attempt.score}</td>
            <td>${attempt.timestamp}</td> <!-- This will now display only the date in YYYY-MM-DD format -->
            <td>${attempt.timeSpent}</td>
            <td><a href="view-test-details.html?email=${encodeURIComponent(userEmail)}&attempt=${index}" class="view-more-btn">View Details</a></td>
        </tr>
    `;
});

            // Close table structure
            tableHtml += `
                    </tbody>
                </table>
            `;

            attemptsContainer.innerHTML = tableHtml;
        }

          // Logout functionality
          const logoutButton = document.getElementById('logout-btn');
                logoutButton.addEventListener('click', function() {
                    const confirmation = confirm('Are you sure you want to log out?');
                    if (confirmation) {
                        window.location.href = 'adminlogin.html'; 
                    } else {
                        console.log('Logout cancelled');
                    }
                });

        // Call displayUserTestAttempts when the page loads
        window.onload = function () {
            displayUserTestAttempts();
        };
    </script>

</body>

</html>
