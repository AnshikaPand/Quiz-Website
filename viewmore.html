<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Details</title>
    <link rel="stylesheet" href="/css/admin.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>

<body>
    <div class="Teacher-Page">
        <header>
            <nav>
                <div id="head">
                    <i class='bx bx-menu'></i>
                    <img src="/img/techpathsala-logo.jpeg">
                    <div id="admin-logout-btn"></div>
                    <p id="welcome-admin">Welcome Anshika</p>
                </div>
            </nav>
        </header>

        <div class="sidebar" id="sidebar">
            <ul>
                <li class="menu-title">Dashboard</li>
                <li><a href="teacher.html"><i class='bx bx-home'></i>Home</a></li>
                <li><a href="student-information.html"><i class='bx bxs-user-circle'></i>users</a></li>
                <li><a href="EditeQuestion.html"><i class='bx bx-question-mark'></i>Quizzes</a></li>
            </ul>
        </div>

        <div class="user-details-container" style="margin-left: 300px; margin-top: 100px;">
            <h1>User Details</h1>

            <table id="user-details-table">
                <tr>
                    <th>Name</th>
                    <td id="user-name"></td>
                </tr>
                <tr>
                    <th>Email</th>
                    <td id="user-email"></td>
                </tr>
                <tr>
                    <th>Score</th>
                    <td id="user-score"></td>
                </tr>
                <tr>
                    <th>Answered Questions</th>
                    <td id="answered-questions"></td>
                </tr>
                <tr>
                    <th>Test Count</th>
                    <td id="test-count"></td>
                </tr>
            </table>
        </div>

        <script>
            document.querySelector('.bx-menu').addEventListener('click', function () {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.toggle('active');
            });

            function getQueryParam(param) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(param);
            }

            function displayUserDetails() {
    const email = getQueryParam('email'); // Get the email from the URL
    if (!email) {
        alert('No user selected!');
        return;
    }

    const users = JSON.parse(localStorage.getItem('users')) || [];
    const scores = JSON.parse(localStorage.getItem('scores')) || [];

    const user = users.find(u => u.email === email);
    const userScoreData = scores.find(s => s.email === email) || {};

    if (user) {
        document.getElementById('user-name').textContent = user.name;
        document.getElementById('user-email').textContent = user.email;
        document.getElementById('user-score').textContent = userScoreData.score || 'Not Attempted';

        const answeredQuestionsElement = document.getElementById('answered-questions');
        const answeredQuestions = userScoreData.answeredQuestions || [];

        if (Array.isArray(answeredQuestions) && answeredQuestions.length > 0) {
            answeredQuestionsElement.innerHTML = '<ul>' + answeredQuestions.map((questionObj, index) => {
                // Extract options (A, B, C, D) dynamically
                const options = ['A', 'B', 'C', 'D'].map(optionKey => ({
                    label: optionKey,
                    value: questionObj[optionKey] // Get the value of A, B, C, D
                })).filter(option => option.value); // Filter out undefined options

                const selectedAnswer = questionObj.selectedAnswer || 'None';
                const correctAnswer = questionObj.correctAnswer || 'No correct answer provided';

                // Display the question, options, selected answer, and correct answer
                // .map() is a method that creates a new array by applying a function to each element of the original array.
                return `<li>
                            <strong>Q${index + 1}: ${questionObj.question}</strong><br>
                            Options:<br>
                            ${options.map(option => {
                                // Highlight the selected answer and correct answer
                                const isCorrect = correctAnswer === option.label;
                                const isSelected = selectedAnswer === option.label;
                                return `<span style="${isCorrect ? 'color:green; font-weight:bold;' : ''}${isSelected && !isCorrect ? 'color:red;' : ''}">
                                            ${option.label}. ${option.value}
                                        </span><br>`;
                            }).join('')}
                            Selected Answer: <strong style="${selectedAnswer === correctAnswer ? 'color:green;' : 'color:red;'}">${selectedAnswer}</strong><br>
                            Correct Answer: <strong style="color:green;">${correctAnswer}</strong>
                        </li>`;
            }).join('') + '</ul>';//.join('') takes all the elements of an array and concatenates them into a single string.

        } else {
            answeredQuestionsElement.textContent = 'No answered questions available';
        }

        document.getElementById('test-count').textContent = userScoreData.testCount || 'N/A';
    } else {
        alert('User not found!');
    }
}

window.onload = function () {
    displayUserDetails();
};


        </script>
    </div>
</body>

</html>
